# ä»»åŠ¡æ¨¡å—å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡

- **Task è¡¨**: æ·»åŠ äº† `projectId`ï¼ˆå¿…å¡«ï¼‰ã€è½¯åˆ é™¤å­—æ®µï¼ˆ`isDeleted`, `deletedAt`, `deletedBy`ï¼‰
- **TaskReviewConfig è¡¨**: ä»»åŠ¡å®¡æ ¸é…ç½®å®ä¾‹ï¼Œæ”¯æŒè½¯åˆ é™¤
- **TaskReviewStage è¡¨**: ä»»åŠ¡å®¡æ ¸æ­¥éª¤å®ä¾‹ï¼Œè®°å½•æ¯ä¸ªæ­¥éª¤çš„å®¡æ ¸äººå’ŒçŠ¶æ€
- **TaskParticipant è¡¨**: ä»»åŠ¡å‚ä¸äººå‘˜å…³è”è¡¨

### 2. DTO è®¾è®¡

- **CreateTaskDto**: åˆ›å»ºä»»åŠ¡ï¼ŒåŒ…å«ï¼š
  - åŸºæœ¬ä¿¡æ¯ï¼š`taskName`, `projectId`, `taskCategoryId`, `taskLeaderId`
  - å®¡æ ¸é…ç½®ï¼š`isReviewRequired`, `reviewStageAssignments`ï¼ˆå®¡æ ¸æ­¥éª¤åˆ†é…ï¼‰
  - å‚ä¸äººå‘˜ï¼š`participantIds`
  - å…¶ä»–ï¼š`description`, `attachments`

- **ReviewStageAssignmentDto**: å®¡æ ¸æ­¥éª¤åˆ†é…
  - `stepConfigId`: æ­¥éª¤æ¨¡æ¿ID
  - `stepName`: æ­¥éª¤åç§°
  - `reviewerId`: å®¡æ ¸äººID
  - æ³¨æ„ï¼šæ­¥éª¤é¡ºåºç”±æ•°ç»„ç´¢å¼•å†³å®šï¼Œæ— éœ€ `stepOrder` å­—æ®µ

- **UpdateTaskDto**: æ›´æ–°ä»»åŠ¡ï¼ˆä»…åŸºæœ¬ä¿¡æ¯ï¼‰
- **TaskPaginationDto**: åˆ†é¡µæŸ¥è¯¢ï¼Œæ”¯æŒ `projectId` ç­›é€‰

### 3. Controller è®¾è®¡ï¼ˆéµå¾ªé¡¹ç›®è§„èŒƒï¼‰

è·¯ç”±å‰ç¼€ï¼š`/task`

| æ–¹æ³•   | è·¯ç”±                                   | è¯´æ˜                               |
| ------ | -------------------------------------- | ---------------------------------- |
| POST   | `/createTask`                          | åˆ›å»ºä»»åŠ¡                           |
| GET    | `/getTaskList`                         | è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰           |
| GET    | `/detail/:id`                          | è·å–ä»»åŠ¡è¯¦æƒ…                       |
| POST   | `/updateTask/:id`                      | æ›´æ–°ä»»åŠ¡                           |
| DELETE | `/deleteTask/:id`                      | åˆ é™¤ä»»åŠ¡ï¼ˆè½¯åˆ é™¤ï¼‰                 |
| GET    | `/getProjectTaskList/:projectId`       | è·å–é¡¹ç›®ä»»åŠ¡åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰           |
| GET    | `/getProjectTaskSimpleList/:projectId` | è·å–é¡¹ç›®ä»»åŠ¡ç®€å•åˆ—è¡¨ï¼ˆä¸‹æ‹‰é€‰æ‹©ç”¨ï¼‰ |

### 4. Service å®ç°

#### æ ¸å¿ƒæ–¹æ³•ï¼š`addTask()`

ä½¿ç”¨äº‹åŠ¡å¤„ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ï¼š

1. **åˆ›å»ºä»»åŠ¡åŸºæœ¬ä¿¡æ¯**
   - æ˜ç¡®æŒ‡å®šæ¯ä¸ªå­—æ®µï¼ˆä¸ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼‰
   - é¿å… DTO å­—æ®µä¸æ•°æ®åº“å­—æ®µä¸åŒ¹é…

2. **å¤„ç†å‚ä¸äººå‘˜**
   - å¦‚æœæœ‰ `participantIds`ï¼Œæ‰¹é‡åˆ›å»º `TaskParticipant` è®°å½•

3. **å¤„ç†å®¡æ ¸æµç¨‹**ï¼ˆå½“ `isReviewRequired=true` æ—¶ï¼‰
   - è·å–æˆ–åˆ›å»º `ReviewConfig`
   - åˆ›å»º `TaskReviewConfig` å®ä¾‹
   - æ ¹æ® `reviewStageAssignments` åˆ›å»º `TaskReviewStage` è®°å½•
   - æ­¥éª¤é¡ºåº = æ•°ç»„ç´¢å¼• + 1

4. **è¿”å›å®Œæ•´ä»»åŠ¡ä¿¡æ¯**
   - åŒ…å«æ‰€æœ‰å…³è”æ•°æ®ï¼ˆåˆ†ç±»ã€è´Ÿè´£äººã€é¡¹ç›®ã€å‚ä¸äººå‘˜ã€å®¡æ ¸æ­¥éª¤ï¼‰

#### è½¯åˆ é™¤æ–¹æ³•

- `removeTask()`: è½¯åˆ é™¤ä»»åŠ¡åŠç›¸å…³å®¡æ ¸é…ç½®
- `restoreTask()`: æ¢å¤å·²åˆ é™¤çš„ä»»åŠ¡
- `permanentDeleteTask()`: ç‰©ç†åˆ é™¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

#### æŸ¥è¯¢æ–¹æ³•

- æ‰€æœ‰æŸ¥è¯¢é»˜è®¤è¿‡æ»¤ `isDeleted=false`
- æ”¯æŒæŒ‰é¡¹ç›®ç­›é€‰
- æ”¯æŒå…³é”®è¯æœç´¢

## ğŸ§ª å¾…æµ‹è¯•çš„åŠŸèƒ½

### 1. åˆ›å»ºä»»åŠ¡ï¼ˆä¸éœ€è¦å®¡æ ¸ï¼‰

```json
POST /task/createTask
{
  "taskName": "æµ‹è¯•ä»»åŠ¡1",
  "projectId": "é¡¹ç›®ID",
  "taskCategoryId": "åˆ†ç±»ID",
  "taskLeaderId": "è´Ÿè´£äººID",
  "isReviewRequired": false,
  "participantIds": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"],
  "description": "ä»»åŠ¡æè¿°",
  "attachments": null
}
```

### 2. åˆ›å»ºä»»åŠ¡ï¼ˆéœ€è¦å®¡æ ¸ï¼‰

```json
POST /task/createTask
{
  "taskName": "æµ‹è¯•ä»»åŠ¡2",
  "projectId": "é¡¹ç›®ID",
  "taskCategoryId": "åˆ†ç±»ID",
  "taskLeaderId": "è´Ÿè´£äººID",
  "isReviewRequired": true,
  "participantIds": ["ç”¨æˆ·ID1", "ç”¨æˆ·ID2"],
  "reviewStageAssignments": [
    {
      "stepConfigId": "æ­¥éª¤æ¨¡æ¿ID1",
      "stepName": "ä¸€å®¡",
      "reviewerId": "å®¡æ ¸äººID1"
    },
    {
      "stepConfigId": "æ­¥éª¤æ¨¡æ¿ID2",
      "stepName": "äºŒå®¡",
      "reviewerId": "å®¡æ ¸äººID2"
    }
  ],
  "description": "éœ€è¦å®¡æ ¸çš„ä»»åŠ¡",
  "attachments": null
}
```

### 3. æŸ¥è¯¢ä»»åŠ¡åˆ—è¡¨

```
GET /task/getTaskList?pageNum=1&pageSize=10&keyword=æµ‹è¯•&projectId=é¡¹ç›®ID
```

### 4. æŸ¥è¯¢ä»»åŠ¡è¯¦æƒ…

```
GET /task/detail/:taskId
```

### 5. æ›´æ–°ä»»åŠ¡

```json
POST /task/updateTask/:taskId
{
  "id": "ä»»åŠ¡ID",
  "taskName": "æ›´æ–°åçš„ä»»åŠ¡åç§°",
  "description": "æ›´æ–°åçš„æè¿°"
}
```

### 6. åˆ é™¤ä»»åŠ¡

```
DELETE /task/deleteTask/:taskId
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“åŒæ­¥**
   - å·²æ‰§è¡Œ `npx prisma db push` åŒæ­¥æ•°æ®åº“ç»“æ„
   - å¦‚æœæœ‰æ–°çš„ schema å˜æ›´ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ

2. **å…³è”æ•°æ®å‡†å¤‡**
   - æµ‹è¯•å‰éœ€è¦ç¡®ä¿ä»¥ä¸‹æ•°æ®å­˜åœ¨ï¼š
     - é¡¹ç›®ï¼ˆProjectï¼‰
     - ä»»åŠ¡åˆ†ç±»ï¼ˆTaskCategoryï¼‰
     - ç”¨æˆ·ï¼ˆUserï¼‰
     - å®¡æ ¸æ­¥éª¤æ¨¡æ¿ï¼ˆReviewStepTemplateï¼‰

3. **äº‹åŠ¡å¤„ç†**
   - åˆ›å»ºä»»åŠ¡ä½¿ç”¨äº†äº‹åŠ¡ï¼Œä»»ä½•æ­¥éª¤å¤±è´¥éƒ½ä¼šå›æ»š
   - ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

4. **è½¯åˆ é™¤**
   - åˆ é™¤æ“ä½œé»˜è®¤æ˜¯è½¯åˆ é™¤
   - æŸ¥è¯¢æ—¶è‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤è®°å½•
   - å¯ä»¥é€šè¿‡ `restoreTask()` æ¢å¤

5. **å®¡æ ¸æµç¨‹**
   - æ­¥éª¤é¡ºåºç”±æ•°ç»„ç´¢å¼•å†³å®š
   - å¦‚æœä»»åŠ¡åˆ†ç±»æ²¡æœ‰å…³è”å®¡æ ¸é…ç½®ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸´æ—¶é…ç½®

## ğŸ“ ä¸‹ä¸€æ­¥å»ºè®®

1. **å‡†å¤‡æµ‹è¯•æ•°æ®**
   - åˆ›å»ºæµ‹è¯•é¡¹ç›®
   - åˆ›å»ºæµ‹è¯•ç”¨æˆ·
   - åˆ›å»ºå®¡æ ¸æ­¥éª¤æ¨¡æ¿

2. **æµ‹è¯• API**
   - ä½¿ç”¨ Postman æˆ– Swagger æµ‹è¯•å„ä¸ªæ¥å£
   - éªŒè¯äº‹åŠ¡æ˜¯å¦æ­£å¸¸å·¥ä½œ
   - æ£€æŸ¥å…³è”æ•°æ®æ˜¯å¦æ­£ç¡®åˆ›å»º

3. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**
   - ç©ºæ•°ç»„ï¼ˆæ— å‚ä¸äººå‘˜ã€æ— å®¡æ ¸æ­¥éª¤ï¼‰
   - å¿…å¡«å­—æ®µç¼ºå¤±
   - æ— æ•ˆçš„ ID å¼•ç”¨

4. **æ€§èƒ½ä¼˜åŒ–**ï¼ˆå¦‚æœéœ€è¦ï¼‰
   - æ·»åŠ æ•°æ®åº“ç´¢å¼•
   - ä¼˜åŒ–æŸ¥è¯¢è¯­å¥
   - è€ƒè™‘ç¼“å­˜ç­–ç•¥
